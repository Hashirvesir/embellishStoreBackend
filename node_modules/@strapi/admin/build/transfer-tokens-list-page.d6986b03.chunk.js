"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[9600],{12584:function(K,h,t){t.d(h,{Z:function(){return c}});var e=t(32735),s=t(35658),Z=t(94547),m=t(19786),k=t(49372),O=t(87933),l=t(19565),I=t(60216),n=t.n(I),L=t(67879),U=t(53038),D=t(72850),x=t(50563),C=t(4038);const B=({tokenName:r,onClickDelete:i,tokenType:E})=>{const{formatMessage:g}=(0,L.Z)(),{trackUsage:T}=(0,l.rS)(),[p,y]=(0,e.useState)(!1),u=()=>{y(!1),T("willDeleteToken",{tokenType:E}),i()};return e.createElement(D.x,{paddingLeft:1,onClick:d=>d.stopPropagation()},e.createElement(x.h,{onClick:()=>{y(!0)},label:g({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${r}`}),name:"delete",noBorder:!0,icon:e.createElement(C.Z,null)}),e.createElement(l.QH,{onToggleDialog:()=>y(!1),onConfirm:u,isOpen:p}))};B.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired,tokenType:n().string.isRequired};var W=B,F=t(54894),J=t(8471);const Q={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},z=(0,J.ZP)(l.rU)`
  svg {
    path {
      fill: ${({theme:r})=>r.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:r})=>r.colors.neutral800};
      }
    }
  }
`,M=({tokenName:r,tokenId:i,buttonType:E,children:g})=>{const{formatMessage:T}=(0,L.Z)(),{location:{pathname:p}}=(0,U.k6)();return e.createElement(z,{to:`${p}/${i}`,title:T(Q[E],{target:r})},g)};M.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},M.defaultProps={buttonType:"edit"};var S=M;const f=({tokenName:r,tokenId:i})=>e.createElement(S,{tokenName:r,tokenId:i,buttonType:"read"},e.createElement(F.Z,null));f.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};var v=f,$=t(68625);const A=({tokenName:r,tokenId:i})=>e.createElement(S,{tokenName:r,tokenId:i},e.createElement($.Z,null));A.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};var H=A;const R=({permissions:r,headers:i,contentType:E,isLoading:g,tokens:T,onConfirmDelete:p,tokenType:y})=>{const{canDelete:u,canUpdate:d,canRead:P}=r,b=u||d||P,[{query:V}]=(0,l.Kx)(),{formatMessage:N}=(0,L.Z)(),[,Y]=V?V.sort.split(":"):"ASC",{push:j,location:{pathname:w}}=(0,U.k6)(),{trackUsage:a}=(0,l.rS)(),X=T.sort((o,q)=>{const G=o.name.localeCompare(q.name);return Y==="DESC"?-G:G});return e.createElement(l.tM,{headers:i,contentType:E,rows:T,withBulkActions:b,isLoading:g,onConfirmDelete:p},e.createElement(s.p,null,X.map(o=>e.createElement(Z.Tr,{key:o.id,...(0,l.X7)({fn(){a("willEditTokenFromList",{tokenType:y}),j(`${w}/${o.id}`)},condition:d})},e.createElement(m.Td,{maxWidth:(0,l.Q1)(250)},e.createElement(k.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0},o.name)),e.createElement(m.Td,{maxWidth:(0,l.Q1)(250)},e.createElement(k.Z,{textColor:"neutral800",ellipsis:!0},o.description)),e.createElement(m.Td,null,e.createElement(k.Z,{textColor:"neutral800"},e.createElement(l.ij,{timestamp:new Date(o.createdAt)}))),e.createElement(m.Td,null,o.lastUsedAt&&e.createElement(k.Z,{textColor:"neutral800"},e.createElement(l.ij,{timestamp:new Date(o.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:N({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]}))),b&&e.createElement(m.Td,null,e.createElement(O.k,{justifyContent:"end"},d&&e.createElement(H,{tokenName:o.name,tokenId:o.id}),!d&&P&&e.createElement(v,{tokenName:o.name,tokenId:o.id}),u&&e.createElement(W,{tokenName:o.name,onClickDelete:()=>p(o.id),tokenType:y})))))))};R.propTypes={tokens:n().array,permissions:n().shape({canRead:n().bool,canDelete:n().bool,canUpdate:n().bool}).isRequired,headers:n().arrayOf(n().shape({cellFormatter:n().func,key:n().string.isRequired,metadatas:n().shape({label:n().string.isRequired,sortable:n().bool}).isRequired,name:n().string.isRequired})),contentType:n().string.isRequired,isLoading:n().bool,onConfirmDelete:n().func,tokenType:n().string.isRequired},R.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};var c=R},49756:function(K,h,t){t.d(h,{Z:function(){return e},f:function(){return s}});const e="api-token",s="transfer-token"},51318:function(K,h,t){t.r(h),t.d(h,{default:function(){return M}});var e=t(32735),s=t(19565),Z=t(15062),m=t(30305),k=t(27649),O=t(82055),l=t(17e3),I=t(19406),n=t(33348),L=t.n(n),U=t(67879),D=t(20108),x=t(53038),C=t(49756),B=t(12584),F=[{name:"name",key:"name",metadatas:{label:{id:"Settings.tokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.tokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],Q=()=>{(0,s.go)();const S=(0,D.useQueryClient)(),{formatMessage:f}=(0,U.Z)(),v=(0,s.lm)(),$=(0,Z.v9)(m._),{allowedActions:{canCreate:A,canDelete:H,canUpdate:R,canRead:c}}=(0,s.ss)($.settings["transfer-tokens"]),{push:r}=(0,x.k6)(),{trackUsage:i}=(0,s.rS)(),{startSection:E}=(0,s.c1)(),g=(0,e.useRef)(E),{get:T,del:p}=(0,s.kY)();(0,e.useEffect)(()=>{g.current&&g.current("transferTokens")},[]),(0,e.useEffect)(()=>{r({search:L().stringify({sort:"name:ASC"},{encode:!1})})},[r]);const y=F.map(a=>({...a,metadatas:{...a.metadatas,label:f(a.metadatas.label)}})),{data:u,status:d,isFetching:P}=(0,D.useQuery)(["transfer-tokens"],async()=>{i("willAccessTokenList",{tokenType:C.f});const{data:{data:a}}=await T("/admin/transfer/tokens");return i("didAccessTokenList",{number:a.length,tokenType:C.f}),a},{enabled:c,onError(a){console.log("error",a),a?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?v({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):v({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),b=c&&(d!=="success"&&d!=="error"||d==="success"&&P),V=(0,D.useMutation)(async a=>{await p(`/admin/transfer/tokens/${a}`)},{async onSuccess(){await S.invalidateQueries(["transfer-tokens"])},onError(a){a?.response?.data?.data?v({type:"warning",message:a.response.data.data}):a?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?v({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):v({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),N=u&&u?.length>0,Y=c&&N,j=c&&!N&&!A,w=c&&!N&&A;return e.createElement(k.o,{"aria-busy":b},e.createElement(s.SL,{name:"Transfer Tokens"}),e.createElement(O.T,{title:f({id:"Settings.transferTokens.title",defaultMessage:"Transfer Tokens"}),subtitle:f({id:"Settings.transferTokens.description",defaultMessage:'"List of generated transfer tokens"'}),primaryAction:A?e.createElement(s.Qj,{"data-testid":"create-transfer-token-button",startIcon:e.createElement(I.Z,null),size:"S",onClick:()=>i("willAddTokenFromList",{tokenType:C.f}),to:"/settings/transfer-tokens/create"},f({id:"Settings.transferTokens.create",defaultMessage:"Create new Transfer Token"})):void 0}),e.createElement(l.D,null,!c&&e.createElement(s.ZF,null),Y&&e.createElement(B.Z,{permissions:{canRead:c,canDelete:H,canUpdate:R},headers:y,contentType:"trasfer-tokens",rows:u,isLoading:b,onConfirmDelete:a=>V.mutateAsync(a),tokens:u,tokenType:C.f}),w&&e.createElement(s.dJ,{content:{id:"Settings.transferTokens.addFirstToken",defaultMessage:"Add your first Transfer Token"},action:e.createElement(s.Qj,{variant:"secondary",startIcon:e.createElement(I.Z,null),to:"/settings/transfer-tokens/create"},f({id:"Settings.transferTokens.addNewToken",defaultMessage:"Add new Transfer Token"}))}),j&&e.createElement(s.dJ,{content:{id:"Settings.transferTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},M=()=>{const S=(0,Z.v9)(m._);return e.createElement(s.O4,{permissions:S.settings["transfer-tokens"].main},e.createElement(Q,null))}}}]);
