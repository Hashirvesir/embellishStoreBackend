"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[5162],{36795:function(V,f,t){var e=t(32735),O=t(29397),u=t(87933),v=t(76437),W=t(23866),K=t(31121),U=t(35197),i=t(38837),se=t(3685),re=t(49372),_=t(40801),G=t(8284),A=t(82884),X=t(92802),ie=t(60216),M=t.n(ie),Q=t(67879),D=t(8471),de=t(90769);const m=s=>s.reduce((r,d)=>{const y=d.split(".")[0];return r[y]||(r[y]=[]),r[y].push(d),r},{}),B=(0,D.ZP)(O.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:s})=>s.colors.neutral100};
  }

  thead th span {
    color: ${({theme:s})=>s.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:s})=>s.spaces[3]};
    padding-block-end: ${({theme:s})=>s.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:s})=>s.spaces[2]};
  }
`,oe=s=>{const r=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return s&&(r.push({id:"app.utils.publish",defaultMessage:"Publish"}),r.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),r},Y=s=>{const r=["entry.create","entry.update","entry.delete"];return s&&r.push("entry.publish","entry.unpublish"),{entry:r,media:["media.create","media.update","media.delete"]}},J=e.createContext(),le=({children:s})=>{const{formatMessage:r}=(0,Q.Z)(),{collectionTypes:d,isLoading:y}=(0,de.G)(),P=e.useMemo(()=>d.some(L=>L.options.draftAndPublish===!0),[d]),C=r({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(J.Provider,{value:{isDraftAndPublish:P}},e.createElement(u.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(v.Q,{"aria-hidden":!0},C),y&&e.createElement(W.a,null,r({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(B,{"aria-label":C},s)))};le.propTypes={children:M().oneOfType([M().arrayOf(M().node),M().node]).isRequired};const q=({getHeaders:s=oe})=>{const{isDraftAndPublish:r}=e.useContext(J),{formatMessage:d}=(0,Q.Z)(),y=s(r);return e.createElement(K.S,null,e.createElement(U.Z,null,e.createElement(i.g,null,e.createElement(se.T,null,d({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),y.map(P=>["app.utils.publish","app.utils.unpublish"].includes(P.id)?e.createElement(i.g,{key:P.id,title:d({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(re.Z,{variant:"sigma",textColor:"neutral600"},d(P))):e.createElement(i.g,{key:P.id},e.createElement(re.Z,{variant:"sigma",textColor:"neutral600"},d(P))))))};q.defaultProps={getHeaders:oe},q.propTypes={getHeaders:M().func};const ee=({providedEvents:s})=>{const{isDraftAndPublish:r}=e.useContext(J),d=s||Y(r),{values:y,handleChange:P}=(0,X.u6)(),C="events",L=y.events,w=[],te=m(L),S=({target:{name:E,value:g}})=>{let b=new Set(L);g?b.add(E):b.delete(E),P({target:{name:C,value:Array.from(b)}})},$=({target:{name:E,value:g}})=>{let b=new Set(L);g?d[E].forEach(N=>{w.includes(N)||b.add(N)}):d[E].forEach(N=>b.delete(N)),P({target:{name:C,value:Array.from(b)}})};return e.createElement(_.X,null,Object.entries(d).map(([E,g])=>e.createElement(F,{disabledEvents:w,key:E,name:E,events:g,inputValue:te[E],handleSelect:S,handleSelectAll:$})))};ee.defaultProps={providedEvents:null},ee.propTypes={providedEvents:M().object};const ce=s=>s.replace(/-/g," ").split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1).toLowerCase()).join(" "),F=({disabledEvents:s,name:r,events:d,inputValue:y,handleSelect:P,handleSelectAll:C})=>{const{formatMessage:L}=(0,Q.Z)(),w=d.filter(g=>!s.includes(g)),te=y.length>0,S=y.length===w.length,$=({target:{name:g}})=>{C({target:{name:g,value:!S}})},E=5;return e.createElement(U.Z,null,e.createElement(i.f,null,e.createElement(G.X,{indeterminate:te&&!S,"aria-label":L({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:r,onChange:$,value:S},ce(r))),d.map(g=>e.createElement(i.f,{key:g},e.createElement(A.C,{disabled:s.includes(g),"aria-label":g,name:g,value:y.includes(g),onValueChange:b=>P({target:{name:g,value:b}})}))),d.length<E&&e.createElement(i.f,{colSpan:E-d.length}))};F.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},F.propTypes={disabledEvents:M().array,events:M().array,inputValue:M().array,handleSelect:M().func,handleSelectAll:M().func,name:M().string.isRequired},f.Z={Root:le,Headers:q,Body:ee,EventRow:F}},77476:function(V,f,t){t.d(f,{Z:function(){return fe}});var e=t(32735),O=t(27649),u=t(19565),v=t(20108),W=t(53038),K=t(90769),U=t(82055),i=t(87933),se=t(41415),re=t(17e3),_=t(72850),G=t(15335),A=t(5803),X=t(10369),ie=t(2438),M=t(66456),Q=t(29439),D=t(92802),de=t(60216),m=t.n(de),B=t(67879),oe=t(9592),Y=t(36795);function J(){return e.createElement(Y.Z.Root,null,e.createElement(Y.Z.Headers,null),e.createElement(Y.Z.Body,null))}var le=t(76437),q=t(7563),ee=t(19406),ce=t(21428),F=t(90333);const s=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],r=({name:n,onChange:a,value:o,...c})=>{const{values:{headers:h}}=(0,D.u6)(),[T,l]=(0,e.useState)(s);(0,e.useEffect)(()=>{l(s.filter(p=>!h?.some(x=>x.key!==o&&x.key===p)))},[h,o]);const H=p=>{a({target:{name:n,value:p}})},z=p=>{l(x=>[...x,p]),H(p)};return e.createElement(ce.XU,{...c,onClear:()=>H(""),onChange:H,onCreateOption:z,placeholder:"",value:o},T.map(p=>e.createElement(F.O,{value:p,key:p},p)))};r.defaultProps={value:void 0},r.propTypes={name:m().string.isRequired,onChange:m().func.isRequired,value:m().string};var d=r,P=()=>{const{formatMessage:n}=(0,B.Z)(),{values:a,errors:o}=(0,D.u6)();return e.createElement(i.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(le.Q,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(_.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(D.F2,{validateOnChange:!1,name:"headers",render:({push:c,remove:h})=>e.createElement(G.r,{gap:4},a.headers.map((T,l)=>e.createElement(e.Fragment,{key:`${l}.${T.key}`},e.createElement(A.P,{col:6},e.createElement(D.gN,{as:d,name:`headers.${l}.key`,"aria-label":`row ${l+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:o.headers?.[l]?.key&&o.headers[l].key})),e.createElement(A.P,{col:6},e.createElement(i.k,{alignItems:"flex-end"},e.createElement(_.x,{style:{flex:1}},e.createElement(D.gN,{as:X.o,name:`headers.${l}.value`,"aria-label":`row ${l+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:o.headers?.[l]?.value&&o.headers[l].value})),e.createElement(i.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:o.headers?.[l]?.value?0:5},e.createElement(u.fG,{disabled:a.headers.length===1,onClick:()=>h(l),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:l+1})})))))),e.createElement(A.P,{col:12},e.createElement(q.A,{type:"button",onClick:()=>{c({key:"",value:""})},startIcon:e.createElement(ee.Z,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))},C=t(49372),L=t(27169),w=t(35331),te=t(8471);const S=te.ZP.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),$=({isPending:n,statusCode:a})=>{const{formatMessage:o}=(0,B.Z)();return n?e.createElement(i.k,{gap:2,alignItems:"center"},e.createElement(S,{as:L.Z}),e.createElement(C.Z,null,o({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(i.k,{gap:2,alignItems:"center"},e.createElement(S,{as:M.Z,color:"success700"}),e.createElement(C.Z,null,o({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(i.k,{gap:2,alignItems:"center"},e.createElement(S,{as:w.Z,color:"danger700"}),e.createElement(C.Z,null,o({id:"Settings.error",defaultMessage:"error"})," ",a)):null};$.propTypes={isPending:m().bool.isRequired,statusCode:m().number},$.defaultProps={statusCode:void 0};const E=({statusCode:n,message:a})=>{const{formatMessage:o}=(0,B.Z)();return n>=200&&n<300?e.createElement(i.k,{justifyContent:"flex-end"},e.createElement(C.Z,{textColor:"neutral600",ellipsis:!0},o({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(i.k,{justifyContent:"flex-end"},e.createElement(i.k,{maxWidth:(0,u.Q1)(250),justifyContent:"flex-end",title:a},e.createElement(C.Z,{ellipsis:!0,textColor:"neutral600"},a))):null};E.propTypes={statusCode:m().number,message:m().string},E.defaultProps={statusCode:void 0,message:void 0};const g=({onCancel:n})=>{const{formatMessage:a}=(0,B.Z)();return e.createElement(i.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(i.k,{gap:2,alignItems:"center"},e.createElement(C.Z,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(S,{as:w.Z,color:"neutral400"}))))};g.propTypes={onCancel:m().func.isRequired};const b=({isPending:n,onCancel:a,response:o})=>{const{statusCode:c,message:h}=o,{formatMessage:T}=(0,B.Z)();return e.createElement(_.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(G.r,{gap:4,style:{alignItems:"center"}},e.createElement(A.P,{col:3},e.createElement(C.Z,null,T({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(A.P,{col:3},e.createElement($,{isPending:n,statusCode:c})),e.createElement(A.P,{col:6},n?e.createElement(g,{onCancel:a}):e.createElement(E,{statusCode:c,message:h}))))};b.defaultProps={isPending:!1,onCancel(){},response:{}},b.propTypes={isPending:m().bool,onCancel:m().func,response:m().object};var N=b,k=t(24346);const ge=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,Ee=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,he=({formatMessage:n})=>k.Ry().shape({name:k.Z_().required(n({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(ge,n({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:k.Z_().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(Ee,n({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:k.Vo(a=>{let o=k.IX();if(a.length===1){const{key:c,value:h}=a[0];if(!c&&!h)return o}return o.of(k.Ry().shape({key:k.Z_().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:k.Z_().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:k.IX()}),ue=({handleSubmit:n,triggerWebhook:a,isCreating:o,isTriggering:c,triggerResponse:h,data:T})=>{const{formatMessage:l}=(0,B.Z)(),[H,z]=(0,e.useState)(!1),p=(0,oe.c)(J,async()=>(await t.e(7030).then(t.bind(t,61442))).EventTableEE),x=Z=>Object.keys(Z).length?Object.entries(Z).map(([ne,ae])=>({key:ne,value:ae})):[{key:"",value:""}],R=(0,D.TA)({initialValues:{name:T?.name||"",url:T?.url||"",headers:x(T?.headers||{}),events:T?.events||[]},onSubmit(Z,{resetForm:ne,setSubmitting:ae}){n(Z),ne({values:Z}),ae(!1)},validationSchema:he({formatMessage:l}),validateOnChange:!1,validateOnBlur:!1});return p?e.createElement(D.Hy,{value:R},e.createElement(u.l0,{onSubmit:R.handleSubmit},e.createElement(U.T,{primaryAction:e.createElement(i.k,{gap:2},e.createElement(se.z,{onClick:()=>{a(),z(!0)},variant:"tertiary",startIcon:e.createElement(ie.Z,null),disabled:o||c,size:"L"},l({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(se.z,{startIcon:e.createElement(M.Z,null),type:"submit",size:"L",disabled:!R.dirty,loading:R.isSubmitting},l({id:"global.save",defaultMessage:"Save"}))),title:o?l({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):T?.name,navigationAction:e.createElement(u.rU,{startIcon:e.createElement(Q.Z,null),to:"/settings/webhooks"},l({id:"global.back",defaultMessage:"Back"}))}),e.createElement(re.D,null,e.createElement(i.k,{direction:"column",alignItems:"stretch",gap:4},H&&e.createElement(N,{isPending:c,response:h,onCancel:()=>z(!1)}),e.createElement(_.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(i.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(G.r,{gap:6},e.createElement(A.P,{col:6},e.createElement(D.gN,{as:X.o,name:"name",error:R?.errors?.name&&R.errors.name,label:l({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(A.P,{col:12},e.createElement(D.gN,{as:X.o,name:"url",error:R?.errors?.url&&R.errors.url,label:l({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(P,null),e.createElement(p,null))))))):null};ue.propTypes={data:m().object,handleSubmit:m().func.isRequired,triggerWebhook:m().func.isRequired,isCreating:m().bool.isRequired,isTriggering:m().bool.isRequired,triggerResponse:m().object},ue.defaultProps={data:void 0,triggerResponse:void 0};var pe=ue;const me=n=>({...n,headers:n.headers.reduce((a,{key:o,value:c})=>(o!==""&&(a[o]=c),a),{})});var fe=()=>{const{params:{id:n}}=(0,W.$B)("/settings/webhooks/:id"),a=n==="create",{replace:o}=(0,W.k6)(),c=(0,u.lm)(),{formatAPIError:h}=(0,u.So)(),T=(0,v.useQueryClient)(),{isLoading:l}=(0,K.G)(),{put:H,get:z,post:p}=(0,u.kY)(),{isLoading:x,data:R,error:Z}=(0,v.useQuery)(["webhooks",n],async()=>{const{data:{data:I}}=await z(`/admin/webhooks/${n}`);return I},{enabled:!a});e.useEffect(()=>{Z&&c({type:"warning",message:h(Z)})},[Z,c,h]);const{isLoading:ne,data:ae,isIdle:ve,mutate:Me}=(0,v.useMutation)(()=>p(`/admin/webhooks/${n}/trigger`)),Ce=()=>Me(null,{onError(I){c({type:"warning",message:h(I)})}}),ye=(0,v.useMutation)(I=>p("/admin/webhooks",I)),Pe=(0,v.useMutation)(({id:I,body:j})=>H(`/admin/webhooks/${I}`,j)),be=async I=>{if(a){ye.mutate(me(I),{onSuccess({data:j}){c({type:"success",message:{id:"Settings.webhooks.created"}}),o(`/settings/webhooks/${j.data.id}`)},onError(j){c({type:"warning",message:h(j)})}});return}Pe.mutate({id:n,body:me(I)},{onSuccess(){T.invalidateQueries(["webhooks",n]),c({type:"success",message:{id:"notification.form.success.fields"}})},onError(j){c({type:"warning",message:h(j)})}})};return x||l?e.createElement(u.dO,null):e.createElement(O.o,null,e.createElement(u.SL,{name:"Webhooks"}),e.createElement(pe,{data:R,handleSubmit:be,triggerWebhook:Ce,isCreating:a,isTriggering:ne,isTriggerIdle:ve,triggerResponse:ae?.data.data}))}},5722:function(V,f,t){t.r(f);var e=t(32735),O=t(19565),u=t(15062),v=t(30305),W=t(77476);const K=()=>{const U=(0,u.v9)(v._);return e.createElement(O.O4,{permissions:U.settings.webhooks.create},e.createElement(W.Z,null))};f.default=K},63939:function(V,f,t){t.r(f);var e=t(32735),O=t(19565),u=t(15062),v=t(30305),W=t(77476);const K=()=>{const U=(0,u.v9)(v._);return e.createElement(O.O4,{permissions:U.settings.webhooks.update},e.createElement(W.Z,null))};f.default=K},90333:function(V,f,t){t.d(f,{O:function(){return O}});var e=t(21428);const O=e.Wx},29439:function(V,f,t){t.d(f,{Z:function(){return u}});var e=t(74512);const O=v=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...v,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),u=O},2438:function(V,f,t){t.d(f,{Z:function(){return u}});var e=t(74512);const O=v=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 8 8",...v,children:(0,e.jsx)("path",{fill:"#212134",d:"M2 .93c0-.4.45-.63.78-.41l4.6 3.06c.3.2.3.64 0 .84l-4.6 3.06A.5.5 0 0 1 2 7.07V.93Z"})}),u=O}}]);
